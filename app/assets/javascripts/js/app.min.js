var app=app||{},todos=[];!function(){"use strict";app.Todo=Backbone.Model.extend({defaults:{content:"",completed:!1},toggle:function(){this.set("completed",!this.get("completed"))},storage:function(){app.todos=app.today.toJSON().concat(app.later.toJSON()).concat(app.schedule.toJSON()),localStorage.setItem("todos",JSON.stringify(app.todos))}})}(),function(t){"use strict";app.TodoView=Backbone.View.extend({tagName:"li",template:_.template(t("#item-template").html()),events:{"tap label":"edit","swipeRight label":"toggleCompleted","swipeLeft label":"clear","keypress .edit":"updateOnEnter","blur .edit":"close","swipeUp label":"sortTodos","swipeDown label":"sortTodos"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"all",this.save)},save:function(){this.model.storage();var e={api_key:"abcdefg",todos:JSON.parse(JSON.stringify(app.todos))};console.log(e),t.ajax({type:"post",url:"http://ancient-chamber-4185.herokuapp.com/api.json",data:JSON.stringify(e),contentType:"application/JSON",dataType:"json",scriptCharset:"utf-8",aync:!1,success:function(t){console.log("success",t)}})},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$el.toggleClass("completed",this.model.get("completed")),this.$input=this.$(".edit"),this},toggleCompleted:function(){this.model.toggle()},edit:function(){this.$el.addClass("editing"),this.$input.focus()},close:function(){var t=this.$input.val().trim();this.$input.val(t),t?this.model.set("content",t):this.clear(),this.$el.removeClass("editing")},updateOnEnter:function(t){t.which===ENTER_KEY&&this.close()},clear:function(){var t=0,e=this.model.collection;this.model.destroy(),e.each(function(e){e.set("order",t),t++},this)},sortTodos:function(e){var o=this.model.get("order"),i=t(document.elementFromPoint(e.clientXend,e.clientYend)).attr("data-order"),a,n,s;i&&(i>o?(a=o,n=i,s=-1):(a=i,n=o,s=1),this.model.collection.each(function(t){t.get("order")==o?t.set("order",i):t.get("order")>=a&&t.get("order")<=n&&t.set("order",+t.get("order")+s)},this),this.model.collection.sort())}})}($),function(t){"use strict";app.CardView=Backbone.View.extend({tagName:"section",className:"card",template:_.template(t("#card-template").html()),events:{"tap .add-button":"create","tap .todo-list":"createByList"},initialize:function(e,o){var i=["today","later","schedule"];this.collection=e,this.$el.html(this.template({category:o,categoryName:i[o]})),this.$el.addClass(i[o]),t("#todoapp").append(this.el),this.listenTo(e,"add",this.addOne),this.listenTo(e,"sort",this.addAll),this.collection.sort()},addAll:function(){this.$el.children(".todo-list").html(""),this.collection.each(this.addOne,this)},addOne:function(t){var e=new app.TodoView({model:t});this.$el.children(".todo-list").append(e.render().el)},newAttributes:function(e){return{content:"",completed:!1,order:this.collection.nextOrder(),category_id:t(e.target).attr("data-category")}},create:function(e){this.collection.add(this.newAttributes(e)),t(this.$el.find("label")[this.$el.find("label").length-1]).trigger("tap")},createByList:function(e){t(t(".add-button")[t(e.target).attr("data-category")]).trigger("tap")}})}($),function(t){"use strict";app.AppView=Backbone.View.extend({el:"#todoapp",initialize:function(){var t=new app.CardView(app.today,0),e=new app.CardView(app.later,1),o=new app.CardView(app.schedule,2)}})}($);var ENTER_KEY=13;$(function(){"use strict";var t={api_key:"abcdefg"};$.ajax({type:"post",url:"http://ancient-chamber-4185.herokuapp.com/api.json",data:JSON.stringify(t),contentType:"application/JSON",dataType:"json",scriptCharset:"utf-8",success:function(t){console.log("success",t);var e=Backbone.Collection.extend({model:app.Todo,nextOrder:function(){return this.length?this.length:0}});todos=t?t:JSON.parse(localStorage.getItem("todos")),app.today=new e(todos.filter(function(t){return 0==t.category_id})),app.later=new e(todos.filter(function(t){return 1==t.category_id})),app.schedule=new e(todos.filter(function(t){return 2==t.category_id})),app.today.comparator=app.later.comparator=app.schedule.comparator=function(t){return t.get("order")};var o=new app.AppView}})});