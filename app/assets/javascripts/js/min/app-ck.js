var app=app||{};!function(){"use strict";app.Todo=Backbone.Model.extend({defaults:{category_id:0,content:"",completed:!1},toggle:function(){this.set("completed",!this.get("completed"))},storage:function(){localStorage.setItem("todos",JSON.stringify(app.todos))}})}(),function(t){"use strict";app.TodoView=Backbone.View.extend({tagName:"li",template:_.template(t("#item-template").html()),events:{"tap label":"edit","swipeRight label":"toggleCompleted","swipeLeft label":"clear","keypress .edit":"updateOnEnter","blur .edit":"close","swipeUp label":"sortTodos","swipeDown label":"sortTodos"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"all",this.save)},save:function(){this.model.storage();var e={api_key:"abcdefg",todos:JSON.parse(JSON.stringify(app.todos))};console.log(e),t.ajax({type:"post",url:"http://ancient-chamber-4185.herokuapp.com/api.json",data:JSON.stringify(e),contentType:"application/JSON",dataType:"json",scriptCharset:"utf-8",aync:!1,success:function(t){console.log("success",t)}})},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$el.toggleClass("completed",this.model.get("completed")),this.$input=this.$(".edit"),this},toggleCompleted:function(){this.model.toggle()},edit:function(){this.$el.addClass("editing"),this.$input.focus()},close:function(){var t=this.$input.val().trim();this.$input.val(t),t?this.model.set("content",t):this.clear(),this.$el.removeClass("editing")},updateOnEnter:function(t){t.which===ENTER_KEY&&this.close()},clear:function(){this.model.destroy({silent:!0});var t=0;app.todos.each(function(e){e.set("order",t),t++},this)},sortTodos:function(e){var o=this.model.get("order"),s=t(document.elementFromPoint(e.clientXend,e.clientYend)).attr("data-order"),i,n,a;s&&(s>o?(i=o,n=s,a=-1):(i=s,n=o,a=1),app.todos.each(function(t){t.get("order")==o?t.set("order",s):t.get("order")>=i&&t.get("order")<=n&&t.set("order",+t.get("order")+a)},this),app.todos.sort())}})}($),function(t){"use strict";app.AppView=Backbone.View.extend({el:"#todoapp",events:{"tap .add-button":"create"},initialize:function(){this.listenTo(app.todos,"add",this.addOne),this.listenTo(app.todos,"sort",this.addAll),app.todos.sort()},addOne:function(e){var o=new app.TodoView({model:e});t(".todo-list").append(o.render().el)},addAll:function(){t(".todo-list").html(""),app.todos.each(this.addOne,this)},newAttributes:function(){return{content:"",completed:!1,order:app.todos.nextOrder()}},create:function(){app.todos.add(this.newAttributes()),t(t("label")[t("label").length-1]).trigger("tap")}})}($);var ENTER_KEY=13;$(function(){"use strict";var t={api_key:"abcdefg"};$.ajax({type:"post",url:"http://ancient-chamber-4185.herokuapp.com/api.json",data:JSON.stringify(t),contentType:"application/JSON",dataType:"json",scriptCharset:"utf-8",success:function(t){console.log("success",t);var e=Backbone.Collection.extend({model:app.Todo,url:"api.json",nextOrder:function(){return this.length?this.length:0}});app.todos=new e(t),app.todos.comparator=function(t){return t.get("order")},new app.AppView,console.log(JSON.parse(JSON.stringify(app.todos)))}})});