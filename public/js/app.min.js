var app=app||{};!function(){"use strict";app.Todo=Backbone.Model.extend({defaults:{title:"",completed:!1},toggle:function(){this.set("completed",!this.get("completed"))},storage:function(){localStorage.setItem("todos",JSON.stringify(app.todos))}})}(),function(){"use strict";var t=Backbone.Collection.extend({model:app.Todo,nextOrder:function(){return this.length?this.length:0}});app.todos=localStorage.getItem("todos")?new t(JSON.parse(localStorage.getItem("todos"))):new t,app.todos.comparator=function(t){return t.get("order")}}(),function(t){"use strict";app.TodoView=Backbone.View.extend({tagName:"li",template:_.template(t("#item-template").html()),events:{"tap label":"edit","swipeRight label":"toggleCompleted","swipeLeft label":"clear","keypress .edit":"updateOnEnter","blur .edit":"close","swipeUp label":"sortTodos","swipeDown label":"sortTodos"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"all",this.save)},save:function(){this.model.storage()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$el.toggleClass("completed",this.model.get("completed")),this.$input=this.$(".edit"),this},toggleCompleted:function(){this.model.toggle()},edit:function(){this.$el.addClass("editing"),this.$input.focus()},close:function(){var t=this.$input.val().trim();this.$input.val(t),t?this.model.set("title",t):this.clear(),this.$el.removeClass("editing")},updateOnEnter:function(t){t.which===ENTER_KEY&&this.close()},clear:function(){this.model.destroy();var t=0;app.todos.each(function(e){e.set("order",t),t++},this)},sortTodos:function(e){var o=this.model.get("order"),i=t(document.elementFromPoint(e.clientXend,e.clientYend)).attr("data-order"),s,n,d;i&&(i>o?(s=o,n=i,d=-1):(s=i,n=o,d=1),app.todos.each(function(t){t.get("order")==o?t.set("order",i):t.get("order")>=s&&t.get("order")<=n&&t.set("order",+t.get("order")+d)},this),app.todos.sort())}})}($),function(t){"use strict";app.AppView=Backbone.View.extend({el:"#todoapp",events:{"tap .add-button":"create"},initialize:function(){this.listenTo(app.todos,"add",this.addOne),this.listenTo(app.todos,"sort",this.addAll),app.todos.sort()},addOne:function(e){var o=new app.TodoView({model:e});t(".todo-list").append(o.render().el)},addAll:function(){t(".todo-list").html(""),app.todos.each(this.addOne,this)},newAttributes:function(){return{title:"",completed:!1,order:app.todos.nextOrder()}},create:function(){app.todos.add(this.newAttributes()),t(t("label")[t("label").length-1]).trigger("tap")}})}($);var ENTER_KEY=13;$(function(){"use strict";new app.AppView,console.log(JSON.parse(JSON.stringify(app.todos.models)))});